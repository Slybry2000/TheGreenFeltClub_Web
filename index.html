<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Green Felt Club | Build Your Pool Legacy</title>
    <meta name="description" content="Track matches. Compete with friends. Build your pool legacy. The ultimate match tracker for pool players.">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        green: {
                            850: '#1a4731', // Deep felt green
                            900: '#143625',
                            950: '#0a1f14',
                        },
                        gold: {
                            400: '#fbbf24',
                            500: '#f59e0b',
                            600: '#d97706',
                            700: '#b45309',
                        }
                    },
                    fontFamily: {
                        serif: ['"Playfair Display"', 'serif'],
                        sans: ['Inter', 'sans-serif'],
                    },
                    backgroundImage: {
                        'hero-pattern': "linear-gradient(to bottom, rgba(10, 31, 20, 0.8), rgba(10, 31, 20, 0.95)), url('public/images/hero-bg.jpg')",
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="public/css/styles.css">
</head>
<body class="bg-green-950 text-gray-100 font-sans antialiased overflow-x-hidden selection:bg-gold-500 selection:text-white">

    <!-- Navigation -->
    <nav id="navbar" class="fixed w-full z-50 transition-all duration-300 py-4 px-6 lg:px-12 border-b border-transparent">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <a href="#" class="flex items-center gap-2 group">
                <img src="public/images/gfc-logo-gold.png" alt="Green Felt Club" class="h-12 w-auto object-contain">
            </a>
            
            <div class="hidden md:flex items-center gap-8">
                <a href="#features" class="text-sm font-medium hover:text-gold-400 transition-colors">Features</a>
                <a href="#how-it-works" class="text-sm font-medium hover:text-gold-400 transition-colors">How It Works</a>
                <a href="#philosophy" class="text-sm font-medium hover:text-gold-400 transition-colors">Philosophy</a>
                <a href="#download" class="px-5 py-2.5 bg-gold-600 hover:bg-gold-500 text-white text-sm font-semibold rounded-full transition-all shadow-lg hover:shadow-gold-500/20 transform hover:-translate-y-0.5">
                    Download App
                </a>
            </div>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-btn" class="md:hidden text-white hover:text-gold-400">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden absolute top-full left-0 w-full bg-green-950 border-t border-green-800 p-6 flex-col gap-4 shadow-2xl md:hidden">
            <a href="#features" class="block py-2 text-lg hover:text-gold-400">Features</a>
            <a href="#how-it-works" class="block py-2 text-lg hover:text-gold-400">How It Works</a>
            <a href="#philosophy" class="block py-2 text-lg hover:text-gold-400">Philosophy</a>
            <a href="#download" class="block py-3 text-center bg-gold-600 text-white rounded-lg font-bold">Download App</a>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative min-h-screen flex items-center justify-center pt-20 bg-hero-pattern bg-cover bg-center bg-fixed bg-no-repeat">
        <div class="absolute inset-0 bg-gradient-to-t from-green-950 via-transparent to-transparent"></div>
        
        <div class="container mx-auto px-6 relative z-10 text-center">
            <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-green-900/50 border border-green-700/50 backdrop-blur-sm mb-8 animate-fade-in-up">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                <span class="text-green-300 text-xs font-semibold tracking-wider uppercase">Beta Access Open</span>
            </div>
            
            <h1 class="font-serif text-5xl md:text-7xl lg:text-8xl font-bold mb-6 leading-tight animate-fade-in-up delay-100">
                Track Matches.<br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-gold-400 to-gold-600">Build Your Legacy.</span>
            </h1>
            
            <p class="text-gray-300 text-lg md:text-xl max-w-2xl mx-auto mb-10 font-light animate-fade-in-up delay-200">
                The definitive match tracker for casual play, leagues, and competitive friends. 
                Turn every game on the green felt into a statistic that matters.
            </p>
            
            <div class="flex flex-col sm:flex-row items-center justify-center gap-4 animate-fade-in-up delay-300">
                <a href="#download" class="w-full sm:w-auto px-8 py-4 bg-gold-600 hover:bg-gold-500 text-white rounded-lg font-bold text-lg transition-all shadow-xl shadow-gold-900/20 flex items-center justify-center gap-2">
                    <i data-lucide="download" class="w-5 h-5"></i>
                    Get the App
                </a>
                <a href="#how-it-works" class="w-full sm:w-auto px-8 py-4 bg-transparent border border-gray-600 hover:border-white hover:bg-white/5 text-white rounded-lg font-semibold text-lg transition-all flex items-center justify-center gap-2">
                    <i data-lucide="play-circle" class="w-5 h-5"></i>
                    See How It Works
                </a>
            </div>

            <!-- Live Stats Ticker (Simulated) -->
            <div class="mt-16 grid grid-cols-2 md:grid-cols-4 gap-8 max-w-4xl mx-auto border-t border-green-800/50 pt-8 animate-fade-in-up delay-500">
                <div class="text-center">
                    <div class="text-3xl font-bold font-serif text-white" id="stat-matches">1,240</div>
                    <div class="text-xs text-gray-400 uppercase tracking-widest mt-1">Matches Today</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold font-serif text-white" id="stat-players">842</div>
                    <div class="text-xs text-gray-400 uppercase tracking-widest mt-1">Active Players</div>
                </div>
                <div class="text-center">
                    <div class="flex items-center justify-center gap-2">
                        <img src="public/images/gold-8-ball.png" alt="8-Ball" class="w-8 h-8 rounded-full shadow-lg">
                        <div class="text-3xl font-bold font-serif text-gold-500">8-Ball</div>
                    </div>
                    <div class="text-xs text-gray-400 uppercase tracking-widest mt-1">Most Played</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold font-serif text-white">98%</div>
                    <div class="text-xs text-gray-400 uppercase tracking-widest mt-1">Satisfaction</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Intro Section -->
    <section class="py-24 bg-green-950 relative overflow-hidden">
        <div class="absolute top-0 right-0 w-1/3 h-full bg-gradient-to-l from-green-900/20 to-transparent"></div>
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row items-center gap-16">
                <div class="w-full md:w-1/2 relative">
                    <div class="absolute -inset-4 bg-gold-600/10 rounded-2xl blur-2xl"></div>
                    <img src="public/images/action.jpg" alt="Player lining up a shot" class="relative rounded-2xl shadow-2xl border border-green-800 grayscale hover:grayscale-0 transition-all duration-700">
                </div>
                <div class="w-full md:w-1/2">
                    <h2 class="font-serif text-3xl md:text-4xl font-bold mb-6 text-white">More Than Just a Game.<br>It's Your Record.</h2>
                    <p class="text-gray-300 leading-relaxed mb-6">
                        You play every week at the bar, at home, or the local hall. But who won last week? What's your actual win rate against Dave? 
                    </p>
                    <p class="text-gray-300 leading-relaxed mb-8">
                        <strong class="text-gold-400">The Green Felt Club</strong> is the personal match tracker built for the rest of us. 
                        No bureaucratic league forms, no complex fees—just you, your friends, and the raw stats of your glory (and defeats).
                    </p>
                    <ul class="space-y-4">
                        <li class="flex items-start gap-3">
                            <i data-lucide="check-circle" class="w-6 h-6 text-gold-500 shrink-0"></i>
                            <span class="text-gray-200">Track 8-Ball, 9-Ball, and Straight Pool instantly.</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i data-lucide="check-circle" class="w-6 h-6 text-gold-500 shrink-0"></i>
                            <span class="text-gray-200">Real ELO-based rating system adapted for casual play.</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i data-lucide="check-circle" class="w-6 h-6 text-gold-500 shrink-0"></i>
                            <span class="text-gray-200">Settle arguments with detailed Head-to-Head records.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Grid -->
    <section id="features" class="py-24 bg-green-900/30">
        <div class="container mx-auto px-6">
            <div class="text-center max-w-3xl mx-auto mb-16">
                <h2 class="font-serif text-3xl md:text-4xl font-bold mb-4">Everything You Need to Compete</h2>
                <p class="text-gray-400">Professional grade tools for your friendly rivalry.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Feature 1 -->
                <div class="bg-green-950 border border-green-800 p-8 rounded-xl hover:border-gold-500/50 transition-colors group cursor-default relative overflow-hidden">
                    <div class="absolute top-4 right-4 flex -space-x-2 opacity-80">
                        <img src="public/images/gold-8-ball.png" alt="8-Ball" class="w-10 h-10 rounded-full border border-green-900 shadow-lg">
                        <img src="public/images/gold-9-ball.png" alt="9-Ball" class="w-10 h-10 rounded-full border border-green-900 shadow-lg">
                    </div>
                    <div class="w-14 h-14 bg-green-900 rounded-lg flex items-center justify-center mb-6 group-hover:bg-gold-500 transition-colors">
                        <i data-lucide="crosshair" class="w-8 h-8 text-gold-500 group-hover:text-green-950 transition-colors"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 font-serif">Rapid Match Entry</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        Log a game in under 10 seconds. Select opponent, game type, and winner. Back to the table before the rack is set.
                    </p>
                </div>

                <!-- Feature 2 -->
                <div class="bg-green-950 border border-green-800 p-8 rounded-xl hover:border-gold-500/50 transition-colors group cursor-default">
                    <div class="w-14 h-14 bg-green-900 rounded-lg flex items-center justify-center mb-6 group-hover:bg-gold-500 transition-colors">
                        <i data-lucide="trending-up" class="w-8 h-8 text-gold-500 group-hover:text-green-950 transition-colors"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 font-serif">Deep Analytics</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        Visualize your win streaks, break-and-runs, and weekly performance trends. Data that helps you improve.
                    </p>
                </div>

                <!-- Feature 3 -->
                <div class="bg-green-950 border border-green-800 p-8 rounded-xl hover:border-gold-500/50 transition-colors group cursor-default">
                    <div class="w-14 h-14 bg-green-900 rounded-lg flex items-center justify-center mb-6 group-hover:bg-gold-500 transition-colors">
                        <i data-lucide="award" class="w-8 h-8 text-gold-500 group-hover:text-green-950 transition-colors"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 font-serif">Skill Ratings</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        Earn your rank. From "Novice" to "Grandmaster", our dynamic rating system adjusts based on who you beat.
                    </p>
                </div>

                <!-- Feature 4 -->
                <div class="bg-green-950 border border-green-800 p-8 rounded-xl hover:border-gold-500/50 transition-colors group cursor-default">
                    <div class="w-14 h-14 bg-green-900 rounded-lg flex items-center justify-center mb-6 group-hover:bg-gold-500 transition-colors">
                        <i data-lucide="users" class="w-8 h-8 text-gold-500 group-hover:text-green-950 transition-colors"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 font-serif">Groups & Leagues</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        Create a "Club" for your regular Tuesday night crew. See a dedicated leaderboard for just your group.
                    </p>
                </div>

                <!-- Feature 5 -->
                <div class="bg-green-950 border border-green-800 p-8 rounded-xl hover:border-gold-500/50 transition-colors group cursor-default">
                    <div class="w-14 h-14 bg-green-900 rounded-lg flex items-center justify-center mb-6 group-hover:bg-gold-500 transition-colors">
                        <i data-lucide="swords" class="w-8 h-8 text-gold-500 group-hover:text-green-950 transition-colors"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 font-serif">Rivalry Tracking</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        Never forget who's up. Check lifetime H2H stats against any specific friend instantly.
                    </p>
                </div>

                <!-- Feature 6 -->
                <div class="bg-green-950 border border-green-800 p-8 rounded-xl hover:border-gold-500/50 transition-colors group cursor-default">
                    <div class="w-14 h-14 bg-green-900 rounded-lg flex items-center justify-center mb-6 group-hover:bg-gold-500 transition-colors">
                        <i data-lucide="qr-code" class="w-8 h-8 text-gold-500 group-hover:text-green-950 transition-colors"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-3 font-serif">Instant Connect</h3>
                    <p class="text-gray-400 text-sm leading-relaxed">
                        Scan a friend's QR code to add them to your match. No typing names, just play.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Tier Progression Showcase -->
    <section class="py-24 bg-gradient-to-br from-green-950 to-green-900 border-y border-green-800">
        <div class="container mx-auto px-6">
            <div class="text-center max-w-3xl mx-auto mb-16">
                <h2 class="font-serif text-3xl md:text-4xl font-bold mb-4 text-white">Climb the Ranks</h2>
                <p class="text-gray-400 text-lg">
                    From the local bar to the hall of fame. Prove your skill with our ELO-based rating system.
                </p>
            </div>

            <div class="flex flex-col lg:flex-row gap-8 justify-center items-center">
                <!-- Tier 1 -->
                <div class="bg-black/30 p-6 rounded-xl border border-green-800 w-full lg:w-64 text-center hover:border-gold-600/30 transition-all group">
                    <div class="w-16 h-16 mx-auto bg-green-900 rounded-full flex items-center justify-center mb-4 group-hover:bg-gold-600 transition-colors">
                        <i data-lucide="beer" class="w-8 h-8 text-gold-500 group-hover:text-white transition-colors"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 font-serif">Bar Room Novice</h3>
                    <div class="text-xs font-bold text-gold-500 uppercase tracking-widest mb-4">ELO < 1200</div>
                    <p class="text-gray-400 text-sm">Where everyone starts. It's about the fun and the occasional lucky shot.</p>
                </div>

                <!-- Connector (Hidden on mobile) -->
                <div class="hidden lg:block">
                    <i data-lucide="chevron-right" class="w-8 h-8 text-green-700"></i>
                </div>

                <!-- Tier 2 -->
                <div class="bg-black/30 p-6 rounded-xl border border-green-800 w-full lg:w-64 text-center hover:border-gold-600/30 transition-all group">
                    <div class="w-16 h-16 mx-auto bg-green-900 rounded-full flex items-center justify-center mb-4 group-hover:bg-gold-600 transition-colors">
                        <i data-lucide="target" class="w-8 h-8 text-gold-500 group-hover:text-white transition-colors"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 font-serif">Club Regular</h3>
                    <div class="text-xs font-bold text-gold-500 uppercase tracking-widest mb-4">ELO 1200 - 1500</div>
                    <p class="text-gray-400 text-sm">Consistent mechanics. You win more than you lose, and you know your angles.</p>
                </div>

                <!-- Connector -->
                <div class="hidden lg:block">
                    <i data-lucide="chevron-right" class="w-8 h-8 text-green-700"></i>
                </div>

                <!-- Tier 3 -->
                <div class="bg-black/30 p-6 rounded-xl border border-green-800 w-full lg:w-64 text-center hover:border-gold-600/30 transition-all group">
                    <div class="w-16 h-16 mx-auto bg-green-900 rounded-full flex items-center justify-center mb-4 group-hover:bg-gold-600 transition-colors">
                        <i data-lucide="swords" class="w-8 h-8 text-gold-500 group-hover:text-white transition-colors"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 font-serif">Table Shark</h3>
                    <div class="text-xs font-bold text-gold-500 uppercase tracking-widest mb-4">ELO 1500 - 1800</div>
                    <p class="text-gray-400 text-sm">You own the table. Friends fear your break and respect your safety play.</p>
                </div>

                <!-- Connector -->
                <div class="hidden lg:block">
                    <i data-lucide="chevron-right" class="w-8 h-8 text-green-700"></i>
                </div>

                <!-- Tier 4 -->
                <div class="bg-gradient-to-b from-green-900 to-black p-6 rounded-xl border border-gold-500 w-full lg:w-64 text-center shadow-[0_0_30px_rgba(234,179,8,0.15)] transform scale-105">
                    <div class="w-16 h-16 mx-auto bg-gold-500 rounded-full flex items-center justify-center mb-4">
                        <i data-lucide="crown" class="w-8 h-8 text-black fill-black/20"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 font-serif">Grandmaster</h3>
                    <div class="text-xs font-bold text-gold-400 uppercase tracking-widest mb-4">ELO 1800+</div>
                    <p class="text-gray-300 text-sm">Legendary status. Your name is on the wall and your legacy is set.</p>
                </div>
            </div>
            
            <!-- Static Stats Example -->
            <div class="mt-16 bg-black/40 rounded-2xl border border-green-800 p-8 max-w-4xl mx-auto flex flex-col md:flex-row items-center gap-8">
                <div class="w-full md:w-1/3 text-center md:text-left">
                    <div class="text-sm text-gold-500 font-bold uppercase tracking-wider mb-2">Live Player Card</div>
                    <h3 class="text-2xl font-bold text-white font-serif mb-2">Detailed Records</h3>
                    <p class="text-gray-400 text-sm">Every match updates your card instantly. Show off your win rate, streaks, and best breaks.</p>
                </div>
                <div class="w-full md:w-2/3 bg-green-950 rounded-lg p-4 border border-green-800 flex items-center gap-4">
                     <div class="w-16 h-16 bg-gold-600 rounded-full flex items-center justify-center text-2xl font-bold text-white font-serif border-4 border-green-900 shadow-lg shrink-0">
                        GM
                     </div>
                     <div class="flex-grow">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-bold text-white text-lg">Grandmaster Mike</span>
                            <span class="text-gold-400 font-bold">2,105 ELO</span>
                        </div>
                        <div class="w-full bg-green-900 h-2 rounded-full overflow-hidden">
                            <div class="bg-gold-500 h-full w-[85%]"></div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-400 mt-2">
                            <span>Win Rate: 68%</span>
                            <span>Streak: 5 W</span>
                            <span>Rank: #3 Local</span>
                        </div>
                     </div>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works -->
    <section id="how-it-works" class="py-24 bg-green-950">
        <div class="container mx-auto px-6">
            <h2 class="font-serif text-3xl md:text-4xl font-bold mb-16 text-center">Your Path to Glory</h2>
            
            <div class="relative">
                <!-- Line -->
                <div class="hidden md:block absolute left-1/2 top-0 bottom-0 w-px bg-green-800 -translate-x-1/2"></div>

                <!-- Step 1 -->
                <div class="relative flex flex-col md:flex-row items-center mb-16 group">
                    <div class="md:w-1/2 pr-0 md:pr-12 text-center md:text-right order-2 md:order-1">
                        <h3 class="text-xl font-bold text-white mb-2 group-hover:text-gold-400 transition-colors">1. Create Profile</h3>
                        <p class="text-gray-400 text-sm">Download the app, set your nickname, and choose your home venue.</p>
                    </div>
                    <div class="absolute left-1/2 -translate-x-1/2 w-10 h-10 bg-green-900 border-2 border-gold-500 rounded-full flex items-center justify-center z-10 text-gold-500 font-bold hidden md:flex">1</div>
                    <div class="md:w-1/2 pl-0 md:pl-12 order-1 md:order-2 mb-6 md:mb-0">
                        <div class="w-16 h-16 bg-green-900/50 rounded-lg flex items-center justify-center mx-auto md:mx-0 border border-green-800">
                            <i data-lucide="user-plus" class="w-8 h-8 text-gray-300"></i>
                        </div>
                    </div>
                </div>

                <!-- Step 2 -->
                <div class="relative flex flex-col md:flex-row items-center mb-16 group">
                    <div class="md:w-1/2 pr-0 md:pr-12 text-center md:text-right order-2 md:order-1 md:text-left md:order-2 md:pl-12 md:pr-0">
                         <h3 class="text-xl font-bold text-white mb-2 group-hover:text-gold-400 transition-colors">2. Add Friends</h3>
                         <p class="text-gray-400 text-sm">Scan QR codes or search usernames to build your rivalry list.</p>
                    </div>
                    <div class="absolute left-1/2 -translate-x-1/2 w-10 h-10 bg-green-900 border-2 border-gold-500 rounded-full flex items-center justify-center z-10 text-gold-500 font-bold hidden md:flex">2</div>
                    <div class="md:w-1/2 pl-0 md:pl-12 order-1 md:order-2 md:order-1 md:pr-12 md:pl-0 mb-6 md:mb-0">
                        <div class="w-16 h-16 bg-green-900/50 rounded-lg flex items-center justify-center mx-auto md:ml-auto md:mr-0 border border-green-800">
                            <i data-lucide="scan-line" class="w-8 h-8 text-gray-300"></i>
                        </div>
                    </div>
                </div>

                <!-- Step 3 -->
                <div class="relative flex flex-col md:flex-row items-center mb-16 group">
                    <div class="md:w-1/2 pr-0 md:pr-12 text-center md:text-right order-2 md:order-1">
                        <h3 class="text-xl font-bold text-white mb-2 group-hover:text-gold-400 transition-colors">3. Play & Log</h3>
                        <p class="text-gray-400 text-sm">Play 8-ball or 9-ball. Winner taps "Won". Loser verifies. Done.</p>
                    </div>
                    <div class="absolute left-1/2 -translate-x-1/2 w-10 h-10 bg-green-900 border-2 border-gold-500 rounded-full flex items-center justify-center z-10 text-gold-500 font-bold hidden md:flex">3</div>
                    <div class="md:w-1/2 pl-0 md:pl-12 order-1 md:order-2 mb-6 md:mb-0">
                        <div class="w-16 h-16 bg-green-900/50 rounded-lg flex items-center justify-center mx-auto md:mx-0 border border-green-800">
                            <i data-lucide="play" class="w-8 h-8 text-gray-300"></i>
                        </div>
                    </div>
                </div>

                <!-- Step 4 -->
                <div class="relative flex flex-col md:flex-row items-center group">
                    <div class="md:w-1/2 pr-0 md:pr-12 text-center md:text-right order-2 md:order-1 md:text-left md:order-2 md:pl-12 md:pr-0">
                         <h3 class="text-xl font-bold text-white mb-2 group-hover:text-gold-400 transition-colors">4. Watch Stats Evolve</h3>
                         <p class="text-gray-400 text-sm">See your rating climb (or fall) and analyze your historical data.</p>
                    </div>
                    <div class="absolute left-1/2 -translate-x-1/2 w-10 h-10 bg-green-900 border-2 border-gold-500 rounded-full flex items-center justify-center z-10 text-gold-500 font-bold hidden md:flex">4</div>
                    <div class="md:w-1/2 pl-0 md:pl-12 order-1 md:order-2 md:order-1 md:pr-12 md:pl-0 mb-6 md:mb-0">
                        <div class="w-16 h-16 bg-green-900/50 rounded-lg flex items-center justify-center mx-auto md:ml-auto md:mr-0 border border-green-800">
                            <i data-lucide="bar-chart-2" class="w-8 h-8 text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- App Showcase -->
    <section class="py-24 bg-green-900/20">
        <div class="container mx-auto px-6 text-center">
            <h2 class="font-serif text-3xl md:text-4xl font-bold mb-16">Designed for the Dimly Lit Room</h2>
            
            <!-- Screenshots Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 justify-items-center max-w-7xl mx-auto">
                
                <!-- Screen 1: Setup -->
                <div class="group">
                    <div class="relative w-64 border-gray-800 bg-gray-800 border-[8px] rounded-[2.5rem] shadow-2xl transition-transform duration-300 group-hover:-translate-y-2">
                        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-24 h-4 bg-gray-800 rounded-b-xl z-10"></div>
                        <div class="rounded-[2rem] overflow-hidden bg-black aspect-[9/19]">
                            <img src="public/images/app-screen-setup.jpg" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity" alt="Game Setup">
                        </div>
                    </div>
                    <p class="mt-6 text-gold-500 font-bold text-lg">Quick Setup</p>
                    <p class="text-sm text-gray-400">Configure game type and players in seconds.</p>
                </div>

                <!-- Screen 2: Teams -->
                <div class="group">
                    <div class="relative w-64 border-gray-800 bg-gray-800 border-[8px] rounded-[2.5rem] shadow-2xl transition-transform duration-300 group-hover:-translate-y-2 delay-75">
                         <div class="absolute top-0 left-1/2 -translate-x-1/2 w-24 h-4 bg-gray-800 rounded-b-xl z-10"></div>
                        <div class="rounded-[2rem] overflow-hidden bg-black aspect-[9/19]">
                            <img src="public/images/app-screen-teams.png" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity" alt="Team Selection">
                        </div>
                    </div>
                    <p class="mt-6 text-gold-500 font-bold text-lg">Team Play</p>
                    <p class="text-sm text-gray-400">Support for 1v1, 2v2, and cut-throat.</p>
                </div>

                <!-- Screen 3: Live -->
                <div class="group">
                    <div class="relative w-64 border-gray-800 bg-gray-800 border-[8px] rounded-[2.5rem] shadow-2xl transition-transform duration-300 group-hover:-translate-y-2 delay-150">
                         <div class="absolute top-0 left-1/2 -translate-x-1/2 w-24 h-4 bg-gray-800 rounded-b-xl z-10"></div>
                        <div class="rounded-[2rem] overflow-hidden bg-black aspect-[9/19]">
                            <img src="public/images/app-screen-live.jpg" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity" alt="Live Tracking">
                        </div>
                    </div>
                    <p class="mt-6 text-gold-500 font-bold text-lg">Live Tracking</p>
                    <p class="text-sm text-gray-400">Visual ball tracking for every shot.</p>
                </div>

                <!-- Screen 4: Rules -->
                <div class="group">
                    <div class="relative w-64 border-gray-800 bg-gray-800 border-[8px] rounded-[2.5rem] shadow-2xl transition-transform duration-300 group-hover:-translate-y-2 delay-200">
                         <div class="absolute top-0 left-1/2 -translate-x-1/2 w-24 h-4 bg-gray-800 rounded-b-xl z-10"></div>
                        <div class="rounded-[2rem] overflow-hidden bg-black aspect-[9/19]">
                            <img src="public/images/app-screen-rules.jpg" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity" alt="Rules Config">
                        </div>
                    </div>
                    <p class="mt-6 text-gold-500 font-bold text-lg">House Rules</p>
                    <p class="text-sm text-gray-400">Customize rules to match your local hall.</p>
                </div>

            </div>
        </div>
    </section>

    <!-- Philosophy -->
    <section id="philosophy" class="py-24 bg-green-950 relative">
        <div class="absolute inset-0 bg-[url('public/images/social.jpg')] bg-cover bg-center opacity-10"></div>
        <div class="container mx-auto px-6 relative z-10">
            <div class="max-w-3xl mx-auto text-center">
                <i data-lucide="quote" class="w-12 h-12 text-gold-600 mx-auto mb-6 opacity-50"></i>
                <h2 class="font-serif text-3xl md:text-5xl font-bold mb-8 leading-tight">"Pool is social. But winning is sweet."</h2>
                <p class="text-xl text-gray-300 font-light italic mb-8">
                    We built this because we were tired of losing track. We wanted to know, definitively, who was the best player in our group. 
                    Not for money, not for a plastic trophy, but for the legacy.
                </p>
                <div class="flex items-center justify-center gap-4">
                    <div class="w-12 h-12 bg-gray-700 rounded-full overflow-hidden">
                        <!-- Generic avatar placeholder using CSS -->
                        <div class="w-full h-full bg-gray-600 flex items-center justify-center text-xl font-bold text-gray-400">JM</div>
                    </div>
                    <div class="text-left">
                        <div class="text-white font-bold">John Maker</div>
                        <div class="text-gold-500 text-sm">Founder & Lifelong Player</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Download CTA -->
    <section id="download" class="py-24 bg-gradient-to-t from-black to-green-950">
        <div class="container mx-auto px-6 text-center">
            <h2 class="font-serif text-4xl md:text-6xl font-bold mb-8 text-white">Start Your Legacy Today</h2>
            <p class="text-gray-400 text-lg mb-12 max-w-2xl mx-auto">
                Join the early access program. The felt is waiting.
            </p>
            
            <div class="flex flex-col sm:flex-row items-center justify-center gap-6">
                <button class="flex items-center gap-3 bg-white text-black px-6 py-3 rounded-xl hover:bg-gray-200 transition-colors w-64 justify-center">
                    <i data-lucide="apple" class="w-8 h-8"></i>
                    <div class="text-left">
                        <div class="text-xs font-semibold">Download on the</div>
                        <div class="text-xl font-bold leading-none">App Store</div>
                    </div>
                </button>
                <button class="flex items-center gap-3 bg-transparent border border-gray-600 text-white px-6 py-3 rounded-xl hover:bg-white/10 transition-colors w-64 justify-center">
                    <i data-lucide="play-circle" class="w-8 h-8"></i>
                    <div class="text-left">
                        <div class="text-xs font-semibold">GET IT ON</div>
                        <div class="text-xl font-bold leading-none">Google Play</div>
                    </div>
                </button>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-black py-12 border-t border-green-900">
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-between items-center mb-8">
                <div class="flex items-center gap-2 mb-4 md:mb-0">
                    <div class="w-8 h-8 rounded-full bg-green-900 flex items-center justify-center text-gold-500">
                        <i data-lucide="club" class="w-4 h-4 fill-current"></i>
                    </div>
                    <span class="font-serif text-xl font-bold text-gray-200">Green Felt Club</span>
                </div>
                <div class="flex gap-8">
                    <a href="#" class="text-gray-500 hover:text-white text-sm">Privacy Policy</a>
                    <a href="#" class="text-gray-500 hover:text-white text-sm">Terms of Service</a>
                    <a href="#" class="text-gray-500 hover:text-white text-sm">Contact</a>
                </div>
            </div>
            <div class="text-center md:text-left text-gray-600 text-sm">
                &copy; 2024 Green Felt Club. All rights reserved. Keep it on the table.
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="public/js/main.js"></script>
    <script>
        lucide.createIcons();
    </script>

<script>
/**
 * Iframe element highlight injection script
 * Need to include this script in the target website to support cross-domain iframe highlight function
 *
 * Usage:
 * 1. Add this script to the HTML of the target website
 * 2. Or inject via browser extension, user script, etc.
 */

(function () {
  "use strict";

  // Check if inside an iframe
  if (window.self === window.top) {
    return; // 不在 iframe 中，不执行
  }

  // Check if already initialized
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe highlight script loaded");

  // Create highlight overlay
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // Create hover highlight box (dashed border)
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // Create persistent highlight box for selected node (solid border)
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // Create hover tag display
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // Create selected node tag
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // Store currently selected element
  var selectedElement = null;
  var highlightEnabled = false;

  // Update highlight display of selected element
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // Update selected highlight box position
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // Update selected tag position and content
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // Calculate tag position to ensure it doesn't exceed viewport
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // If tag exceeds top, show below element
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // If tag exceeds right, adjust to left
    var labelWidth = selectedLabel.offsetWidth || 100; // 预估宽度
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // Prioritize checking unique ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // ID唯一，无需继续向上
      }

      // Generate class selector (take first valid class name)
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // Generate position index (nth-child)
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // Handle root element
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // Get element text content
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // Get element attribute information
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // Mouse over event handling
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // Avoid highlighting html and body elements
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // If it is the selected element, do not show hover highlight
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // Update hover highlight box position
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // Update tag position and content
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // Calculate tag position to ensure it doesn't exceed viewport
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // If tag exceeds top, show below element
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // If tag exceeds right, adjust to left
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // Send message to parent window
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Mouse out event handling
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // If mouse moves to highlight related elements, do not hide highlight
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Click event handling
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // Avoid handling html and body elements
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // Check if it is an interactive element, these elements need to retain default behavior
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // If highlight function is enabled, prevent default behavior and event propagation for non-interactive elements
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // Immediately update selected highlight
    updateSelectedHighlight(target);

    // Hide hover highlight because it is now selected
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Listen for messages from parent window
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // Enable highlight function
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // Disable highlight function
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // Keep event listeners but control behavior via highlightEnabled variable
    // This allows retaining the display of selected state
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // Do not hide selectedBox and selectedLabel, retain selected state
  }

  // Fully disable highlight function (remove all listeners)
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // Add event listeners
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // Expose global functions for external calls
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // Control via message send switch
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // Notify parent window that script is loaded
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("Cannot send ready message to parent window:", error);
  }

  // Cleanup function
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe element highlight injection script
 * Need to include this script in the target website to support cross-domain iframe highlight function
 *
 * Usage:
 * 1. Add this script to the HTML of the target website
 * 2. Or inject via browser extension, user script, etc.
 */

(function () {
  "use strict";

  // Check if inside an iframe
  if (window.self === window.top) {
    return; // 不在 iframe 中，不执行
  }

  // Check if already initialized
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe highlight script loaded");

  // Create highlight overlay
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // Create hover highlight box (dashed border)
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // Create persistent highlight box for selected node (solid border)
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // Create hover tag display
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // Create selected node tag
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // Store currently selected element
  var selectedElement = null;
  var highlightEnabled = false;

  // Update highlight display of selected element
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // Update selected highlight box position
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // Update selected tag position and content
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // Calculate tag position to ensure it doesn't exceed viewport
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // If tag exceeds top, show below element
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // If tag exceeds right, adjust to left
    var labelWidth = selectedLabel.offsetWidth || 100; // 预估宽度
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // Prioritize checking unique ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // ID唯一，无需继续向上
      }

      // Generate class selector (take first valid class name)
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // Generate position index (nth-child)
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // Handle root element
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // Get element text content
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // Get element attribute information
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // Mouse over event handling
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // Avoid highlighting html and body elements
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // If it is the selected element, do not show hover highlight
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // Update hover highlight box position
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // Update tag position and content
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // Calculate tag position to ensure it doesn't exceed viewport
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // If tag exceeds top, show below element
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // If tag exceeds right, adjust to left
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // Send message to parent window
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Mouse out event handling
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // If mouse moves to highlight related elements, do not hide highlight
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Click event handling
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // Avoid handling html and body elements
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // Check if it is an interactive element, these elements need to retain default behavior
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // If highlight function is enabled, prevent default behavior and event propagation for non-interactive elements
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // Immediately update selected highlight
    updateSelectedHighlight(target);

    // Hide hover highlight because it is now selected
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Listen for messages from parent window
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // Enable highlight function
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // Disable highlight function
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // Keep event listeners but control behavior via highlightEnabled variable
    // This allows retaining the display of selected state
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // Do not hide selectedBox and selectedLabel, retain selected state
  }

  // Fully disable highlight function (remove all listeners)
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // Add event listeners
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // Expose global functions for external calls
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // Control via message send switch
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // Notify parent window that script is loaded
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("Cannot send ready message to parent window:", error);
  }

  // Cleanup function
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe element highlight injection script
 * Need to include this script in the target website to support cross-domain iframe highlight function
 *
 * Usage:
 * 1. Add this script to the HTML of the target website
 * 2. Or inject via browser extension, user script, etc.
 */

(function () {
  "use strict";

  // Check if inside an iframe
  if (window.self === window.top) {
    return; // 不在 iframe 中，不执行
  }

  // Check if already initialized
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe highlight script loaded");

  // Create highlight overlay
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // Create hover highlight box (dashed border)
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // Create persistent highlight box for selected node (solid border)
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // Create hover tag display
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // Create selected node tag
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // Store currently selected element
  var selectedElement = null;
  var highlightEnabled = false;

  // Update highlight display of selected element
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // Update selected highlight box position
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // Update selected tag position and content
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // Calculate tag position to ensure it doesn't exceed viewport
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // If tag exceeds top, show below element
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // If tag exceeds right, adjust to left
    var labelWidth = selectedLabel.offsetWidth || 100; // 预估宽度
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // Prioritize checking unique ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // ID唯一，无需继续向上
      }

      // Generate class selector (take first valid class name)
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // Generate position index (nth-child)
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // Handle root element
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // Get element text content
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // Get element attribute information
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // Mouse over event handling
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // Avoid highlighting html and body elements
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // If it is the selected element, do not show hover highlight
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // Update hover highlight box position
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // Update tag position and content
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // Calculate tag position to ensure it doesn't exceed viewport
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // If tag exceeds top, show below element
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // If tag exceeds right, adjust to left
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // Send message to parent window
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Mouse out event handling
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // If mouse moves to highlight related elements, do not hide highlight
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Click event handling
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // Avoid handling html and body elements
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // Check if it is an interactive element, these elements need to retain default behavior
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // If highlight function is enabled, prevent default behavior and event propagation for non-interactive elements
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // Immediately update selected highlight
    updateSelectedHighlight(target);

    // Hide hover highlight because it is now selected
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Listen for messages from parent window
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // Enable highlight function
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // Disable highlight function
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // Keep event listeners but control behavior via highlightEnabled variable
    // This allows retaining the display of selected state
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // Do not hide selectedBox and selectedLabel, retain selected state
  }

  // Fully disable highlight function (remove all listeners)
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // Add event listeners
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // Expose global functions for external calls
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // Control via message send switch
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // Notify parent window that script is loaded
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("Cannot send ready message to parent window:", error);
  }

  // Cleanup function
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe element highlight injection script
 * Need to include this script in the target website to support cross-domain iframe highlight function
 *
 * Usage:
 * 1. Add this script to the HTML of the target website
 * 2. Or inject via browser extension, user script, etc.
 */

(function () {
  "use strict";

  // Check if inside an iframe
  if (window.self === window.top) {
    return; // 不在 iframe 中，不执行
  }

  // Check if already initialized
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe highlight script loaded");

  // Create highlight overlay
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // Create hover highlight box (dashed border)
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // Create persistent highlight box for selected node (solid border)
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // Create hover tag display
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // Create selected node tag
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // Store currently selected element
  var selectedElement = null;
  var highlightEnabled = false;

  // Update highlight display of selected element
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // Update selected highlight box position
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // Update selected tag position and content
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // Calculate tag position to ensure it doesn't exceed viewport
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // If tag exceeds top, show below element
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // If tag exceeds right, adjust to left
    var labelWidth = selectedLabel.offsetWidth || 100; // 预估宽度
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // Prioritize checking unique ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // ID唯一，无需继续向上
      }

      // Generate class selector (take first valid class name)
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // Generate position index (nth-child)
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // Handle root element
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // Get element text content
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // Get element attribute information
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // Mouse over event handling
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // Avoid highlighting html and body elements
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // If it is the selected element, do not show hover highlight
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // Update hover highlight box position
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // Update tag position and content
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // Calculate tag position to ensure it doesn't exceed viewport
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // If tag exceeds top, show below element
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // If tag exceeds right, adjust to left
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // Send message to parent window
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Mouse out event handling
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // If mouse moves to highlight related elements, do not hide highlight
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Click event handling
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // Avoid handling html and body elements
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // Check if it is an interactive element, these elements need to retain default behavior
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // If highlight function is enabled, prevent default behavior and event propagation for non-interactive elements
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // Immediately update selected highlight
    updateSelectedHighlight(target);

    // Hide hover highlight because it is now selected
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Listen for messages from parent window
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // Enable highlight function
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // Disable highlight function
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // Keep event listeners but control behavior via highlightEnabled variable
    // This allows retaining the display of selected state
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // Do not hide selectedBox and selectedLabel, retain selected state
  }

  // Fully disable highlight function (remove all listeners)
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // Add event listeners
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // Expose global functions for external calls
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // Control via message send switch
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // Notify parent window that script is loaded
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("Cannot send ready message to parent window:", error);
  }

  // Cleanup function
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe element highlight injection script
 * Need to include this script in the target website to support cross-domain iframe highlight function
 *
 * Usage:
 * 1. Add this script to the HTML of the target website
 * 2. Or inject via browser extension, user script, etc.
 */

(function () {
  "use strict";

  // Check if inside an iframe
  if (window.self === window.top) {
    return; // 不在 iframe 中，不执行
  }

  // Check if already initialized
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe highlight script loaded");

  // Create highlight overlay
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // Create hover highlight box (dashed border)
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // Create persistent highlight box for selected node (solid border)
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // Create hover tag display
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // Create selected node tag
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // Store currently selected element
  var selectedElement = null;
  var highlightEnabled = false;

  // Update highlight display of selected element
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // Update selected highlight box position
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // Update selected tag position and content
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // Calculate tag position to ensure it doesn't exceed viewport
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // If tag exceeds top, show below element
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // If tag exceeds right, adjust to left
    var labelWidth = selectedLabel.offsetWidth || 100; // 预估宽度
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // Prioritize checking unique ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // ID唯一，无需继续向上
      }

      // Generate class selector (take first valid class name)
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // Generate position index (nth-child)
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // Handle root element
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // Get element text content
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // Get element attribute information
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // Mouse over event handling
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // Avoid highlighting html and body elements
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // If it is the selected element, do not show hover highlight
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // Update hover highlight box position
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // Update tag position and content
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // Calculate tag position to ensure it doesn't exceed viewport
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // If tag exceeds top, show below element
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // If tag exceeds right, adjust to left
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // Send message to parent window
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Mouse out event handling
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // If mouse moves to highlight related elements, do not hide highlight
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Click event handling
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // Avoid handling html and body elements
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // Check if it is an interactive element, these elements need to retain default behavior
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // If highlight function is enabled, prevent default behavior and event propagation for non-interactive elements
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // Immediately update selected highlight
    updateSelectedHighlight(target);

    // Hide hover highlight because it is now selected
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Listen for messages from parent window
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // Enable highlight function
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // Disable highlight function
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // Keep event listeners but control behavior via highlightEnabled variable
    // This allows retaining the display of selected state
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // Do not hide selectedBox and selectedLabel, retain selected state
  }

  // Fully disable highlight function (remove all listeners)
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // Add event listeners
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // Expose global functions for external calls
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // Control via message send switch
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // Notify parent window that script is loaded
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("Cannot send ready message to parent window:", error);
  }

  // Cleanup function
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe element highlight injection script
 * Need to include this script in the target website to support cross-domain iframe highlight function
 *
 * Usage:
 * 1. Add this script to the HTML of the target website
 * 2. Or inject via browser extension, user script, etc.
 */

(function () {
  "use strict";

  // Check if inside an iframe
  if (window.self === window.top) {
    return; // 不在 iframe 中，不执行
  }

  // Check if already initialized
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe highlight script loaded");

  // Create highlight overlay
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // Create hover highlight box (dashed border)
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // Create persistent highlight box for selected node (solid border)
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // Create hover tag display
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // Create selected node tag
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // Store currently selected element
  var selectedElement = null;
  var highlightEnabled = false;

  // Update highlight display of selected element
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // Update selected highlight box position
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // Update selected tag position and content
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // Calculate tag position to ensure it doesn't exceed viewport
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // If tag exceeds top, show below element
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // If tag exceeds right, adjust to left
    var labelWidth = selectedLabel.offsetWidth || 100; // 预估宽度
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // Prioritize checking unique ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // ID唯一，无需继续向上
      }

      // Generate class selector (take first valid class name)
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // Generate position index (nth-child)
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // Handle root element
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // Get element text content
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // Get element attribute information
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // Mouse over event handling
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // Avoid highlighting html and body elements
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // If it is the selected element, do not show hover highlight
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // Update hover highlight box position
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // Update tag position and content
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // Calculate tag position to ensure it doesn't exceed viewport
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // If tag exceeds top, show below element
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // If tag exceeds right, adjust to left
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // Send message to parent window
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Mouse out event handling
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // If mouse moves to highlight related elements, do not hide highlight
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Click event handling
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // Avoid handling html and body elements
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // Check if it is an interactive element, these elements need to retain default behavior
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // If highlight function is enabled, prevent default behavior and event propagation for non-interactive elements
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // Immediately update selected highlight
    updateSelectedHighlight(target);

    // Hide hover highlight because it is now selected
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("Cannot send message to parent window:", error);
    }
  }

  // Listen for messages from parent window
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // Enable highlight function
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // Disable highlight function
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // Keep event listeners but control behavior via highlightEnabled variable
    // This allows retaining the display of selected state
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // Do not hide selectedBox and selectedLabel, retain selected state
  }

  // Fully disable highlight function (remove all listeners)
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // Add event listeners
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // Expose global functions for external calls
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // Control via message send switch
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // Notify parent window that script is loaded
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("Cannot send ready message to parent window:", error);
  }

  // Cleanup function
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe 元素高亮注入脚本
 * 需要在目标网站中引入此脚本来支持跨域 iframe 高亮功能
 *
 * 使用方法：
 * 1. 将此脚本添加到目标网站的 HTML 中
 * 2. 或通过浏览器扩展、用户脚本等方式注入
 */

(function () {
  "use strict";

  // 检查是否在 iframe 中
  if (window.self === window.top) {
    return; // 不在 iframe 中，不执行
  }

  // 检查是否已经初始化过
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe 高亮脚本已加载");

  // 创建高亮覆盖层
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // 创建悬停高亮框（虚线边框）
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // 创建选中节点的常驻高亮框（实线边框）
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // 创建悬停标签显示
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // 创建选中节点标签
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // 存储当前选中的元素
  var selectedElement = null;
  var highlightEnabled = false;

  // 更新选中元素的高亮显示
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // 更新选中高亮框位置
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // 更新选中标签位置和内容
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // 计算标签位置，确保不超出视窗
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // 如果标签会超出顶部，显示在元素下方
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // 如果标签会超出右侧，向左调整
    var labelWidth = selectedLabel.offsetWidth || 100; // 预估宽度
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // 优先检查唯一ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // ID唯一，无需继续向上
      }

      // 生成类名选择器（取第一个有效类名）
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // 生成位置索引（nth-child）
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // 处理根元素
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // 获取元素文本内容
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // 获取元素属性信息
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // 鼠标悬停事件处理
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // 避免高亮 html 和 body 元素
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // 如果是已选中的元素，不显示悬停高亮
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // 更新悬停高亮框位置
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // 更新标签位置和内容
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // 计算标签位置，确保不超出视窗
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // 如果标签会超出顶部，显示在元素下方
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // 如果标签会超出右侧，向左调整
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // 发送消息到父窗口
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("无法发送消息到父窗口:", error);
    }
  }

  // 鼠标离开事件处理
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // 如果鼠标移动到高亮相关元素上，不隐藏高亮
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("无法发送消息到父窗口:", error);
    }
  }

  // 点击事件处理
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // 避免处理 html 和 body 元素
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // 检查是否是交互元素，这些元素需要保留默认行为
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // 如果高亮功能启用，对于非交互元素阻止默认行为和事件传播
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // 立即更新选中高亮
    updateSelectedHighlight(target);

    // 隐藏悬停高亮，因为现在是选中状态
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("无法发送消息到父窗口:", error);
    }
  }

  // 监听来自父窗口的消息
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // 启用高亮功能
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // 禁用高亮功能
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // 保持事件监听器，但通过 highlightEnabled 变量控制行为
    // 这样可以保留选中状态的显示
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // 不隐藏 selectedBox 和 selectedLabel，保留选中状态
  }

  // 完全禁用高亮功能（移除所有监听器）
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // 添加事件监听
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // 暴露全局函数供外部调用
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // 通过消息发送开关控制
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // 通知父窗口脚本已加载
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("无法发送就绪消息到父窗口:", error);
  }

  // 清理函数
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>
</body>
</html>